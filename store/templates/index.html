{% extends 'store/base.html' %}
{% load static %}
{% load custom_filters %} 

{% block content %}
<style>
    /* --- HERO SECTION --- */
    .hero-wrap { padding: 30px 0; }
    .main-banner { height: 450px; background-size: cover; background-position: center; border-radius: 10px; position: relative; overflow: hidden; display: flex; align-items: center; padding: 50px; }
    .side-banner { height: 215px; background-size: cover; background-position: center; border-radius: 10px; position: relative; display: flex; align-items: center; padding: 30px; margin-bottom: 20px; transition: 0.3s; }
    .side-banner:last-child { margin-bottom: 0; }
    .side-banner:hover { transform: translateY(-5px); }
    
    .hero-content h4 { font-weight: 300; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; }
    .hero-content h1 { font-size: 50px; font-weight: 700; margin-bottom: 20px; line-height: 1.2; }
    
    /* --- FLASH SALE BAR --- */
    .flash-sale-bar {
        background: #fdf59a; padding: 15px 0; margin: 0 0 40px 0;
        display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;
        border-radius: 5px;
    }
    .flash-text { font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
    .timer-display { font-size: 20px; font-weight: 800; font-family: monospace; }

    /* --- CIRCULAR CATEGORIES --- */
    .cat-circle-item { text-align: center; margin: 30px 0; transition: 0.3s; }
    .cat-circle-item:hover { transform: translateY(-5px); }
    .cat-img-box { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; margin: 0 auto 15px; border: 2px solid transparent; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .cat-circle-item:hover .cat-img-box { border-color: #0d6efd; }
    .cat-img-box img { width: 100%; height: 100%; object-fit: cover; }
    .cat-name { font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }

    /* --- PRODUCT CARD --- */
    .section-title { font-weight: 700; text-transform: uppercase; margin-bottom: 30px; position: relative; display: inline-block; }
    .section-title::after { content: ''; position: absolute; bottom: -10px; left: 0; width: 50px; height: 3px; background: #0d6efd; }
    
    .product-card { border: 1px solid #f0f0f0; border-radius: 8px; overflow: hidden; transition: 0.3s; background: white; position: relative; margin-bottom: 30px; }
    .product-card:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.08); border-color: white; }
    
    .product-img-wrap { height: 280px; position: relative; overflow: hidden; background: #f9f9f9; }
    
    /* FIX: Make image zoom work with link */
    .product-img-link { display: block; width: 100%; height: 100%; }
    .product-img-link img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
    .product-card:hover .product-img-link img { transform: scale(1.05); }
    
    .product-actions { position: absolute; top: 15px; right: -50px; transition: 0.3s; display: flex; flex-direction: column; gap: 10px; z-index: 10; }
    .product-card:hover .product-actions { right: 15px; }
    .action-btn { width: 35px; height: 35px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #333; box-shadow: 0 3px 10px rgba(0,0,0,0.1); transition: 0.3s; }
    .action-btn:hover { background: #0d6efd; color: white; }

    .product-info { padding: 15px; text-align: center; }
    .product-cat { font-size: 11px; text-transform: uppercase; color: #999; margin-bottom: 5px; }
    .product-title { font-weight: 600; font-size: 15px; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .product-price { color: #0d6efd; font-weight: 700; font-size: 16px; }
    .product-price .old-price { color: #ccc; text-decoration: line-through; font-size: 13px; margin-left: 5px; font-weight: 400; }
    
    .btn-shop { background: #0d6efd; color: white; padding: 10px 30px; border-radius: 30px; font-weight: 600; border: none; transition: 0.3s; }
    .btn-shop:hover { background: #004bb5; box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3); }

    /* --- NEW MIXED SECTION STYLES --- */
    .mixed-section { background: #fff; padding: 40px 0; border-top: 1px solid #eee; }
    
    /* Left Sidebar Slider */
    .vertical-banner-slider { 
        height: 100%; min-height: 400px; 
        border-radius: 8px; overflow: hidden; position: relative; 
    }
    .carousel-item-custom { 
        height: 400px; background-size: cover; background-position: center; 
        position: relative;
    }
    .slider-content {
        position: absolute; bottom: 30px; left: 20px; right: 20px;
        background: rgba(255,255,255,0.9); padding: 20px;
        text-align: center; border-radius: 5px;
    }
    .slider-title { font-weight: 700; font-size: 18px; margin-bottom: 5px; text-transform: uppercase; }
    .slider-sub { font-size: 13px; color: #666; margin-bottom: 10px; }
    
    /* Right Side Product Grid Adjustment */
    .mini-card { margin-bottom: 20px; border: 1px solid #f0f0f0; border-radius: 8px; transition: 0.3s; }
    .mini-card:hover { border-color: #000; transform: translateY(-3px); }

</style>

<div class="container hero-wrap">
    <div class="row">
        <div class="col-lg-8 mb-4 mb-lg-0">
            <div class="main-banner" style="background-image: url('{% if main_banner %}{{ main_banner.image.url }}{% else %}https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&w=1470&q=80{% endif %}');">
                <div class="hero-content text-white">
                    {% if main_banner %}
                        <h4>{{ main_banner.small_text }}</h4>
                        <h1>{{ main_banner.main_text }}</h1>
                        <a href="{{ main_banner.button_link }}" class="btn-shop">{{ main_banner.button_text }}</a>
                    {% else %}
                        <h4>New Collection</h4>
                        <h1>Summer Sale <br> Min 40% Off</h1>
                        <a href="#" class="btn-shop">SHOP NOW</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            
            <div class="side-banner" style="background-image: url('{% if side_top %}{{ side_top.image.url }}{% else %}https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=1470&q=80{% endif %}');">
                <div class="hero-content text-white">
                    {% if side_top %}
                        <h4>{{ side_top.small_text }}</h4>
                        <h2>{{ side_top.main_text }}</h2>
                        <a href="{{ side_top.button_link }}" class="text-white fw-bold text-decoration-underline">{{ side_top.button_text }}</a>
                    {% else %}
                        <h4>Men's Shoes</h4>
                        <h2>Up to 50% Off</h2>
                        <a href="#" class="text-white fw-bold text-decoration-underline">Discover Now</a>
                    {% endif %}
                </div>
            </div>

            <div class="side-banner" style="background-image: url('{% if side_bottom %}{{ side_bottom.image.url }}{% else %}https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=870&q=80{% endif %}');">
                <div class="hero-content text-white">
                    {% if side_bottom %}
                        <h4>{{ side_bottom.small_text }}</h4>
                        <h2>{{ side_bottom.main_text }}</h2>
                        <a href="{{ side_bottom.button_link }}" class="text-white fw-bold text-decoration-underline">{{ side_bottom.button_text }}</a>
                    {% else %}
                        <h4>Accessories</h4>
                        <h2>New Arrivals</h2>
                        <a href="#" class="text-white fw-bold text-decoration-underline">Shop Bags</a>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</div>
<div class="container">
    <div class="flash-sale-bar">
        <div class="flash-text">Flash Sale now on!</div>
        <div class="timer-display">00 : 09 : 27 : 59</div>
        <div class="flash-text d-none d-md-block">Save on new arrivals, bestsellers + more</div>
        <button class="btn btn-dark btn-sm rounded-0">FLASH50</button>
    </div>
</div>

<div class="container py-5 border-bottom border-top">
    <div class="d-flex justify-content-between overflow-auto" style="gap: 20px;">
        
        {% for cat in categories %}
        <div class="cat-circle-item">
            <div class="cat-img-box">
                {% if cat.image %}
                    <img src="{{ cat.image.url }}" alt="{{ cat.name }}">
                {% else %}
                    <img src="https://via.placeholder.com/100" alt="{{ cat.name }}">
                {% endif %}
            </div>
            <div class="cat-name">{{ cat.name }}</div>
        </div>
        {% empty %}
            <p>No categories found. Add in Admin Panel.</p>
        {% endfor %}

    </div>
</div>

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="section-title">Featured Products</h3>
        <a href="#" class="btn btn-outline-dark btn-sm rounded-pill px-4">View All</a>
    </div>

    <div class="row">
        {% for product in products %}
        <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="product-card">
                <div class="product-img-wrap">
                    <a href="{% url 'product_detail' product.id %}" class="product-img-link">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        {% else %}
                            <img src="https://via.placeholder.com/300x400" alt="No Image">
                        {% endif %}
                    </a>
                    
                    <div class="product-actions">
                        <a href="#" class="action-btn"><i class="far fa-heart"></i></a>
                        <a href="{% url 'product_detail' product.id %}" class="action-btn"><i class="far fa-eye"></i></a>
                        <a href="{% url 'add_to_cart' product.id %}" class="action-btn"><i class="fas fa-shopping-cart"></i></a>
                    </div>
                </div>
                
                <div class="product-info">
                    <div class="product-cat">{{ product.category }}</div>
                    <div class="product-title"><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></div>
                    <div class="text-warning small mb-2">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                    </div>
                    <div class="product-price">
                        {{ product.selling_price|currency:request }}
                        <span class="old-price">
                            â‚¹ {{ product.cost_price|add:"200" }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="mixed-section">
    <div class="container">
        <div class="row">
            
            <div class="col-lg-4 mb-4 mb-lg-0">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="fw-bold text-uppercase m-0" style="letter-spacing: 1px;">Men's Fashion</h4>
                    <a href="#" class="small text-muted text-decoration-underline">View All</a>
                </div>

                <div id="menSlider" class="carousel slide vertical-banner-slider shadow-sm" data-bs-ride="carousel">
                    <div class="carousel-inner h-100">
                        <div class="carousel-item active carousel-item-custom" style="background-image: url('https://images.unsplash.com/photo-1550246140-5119980d708e?q=80&w=1000');">
                            <div class="slider-content">
                                <div class="slider-title">Men's Accessories</div>
                                <div class="slider-sub">Sale 30% Off</div>
                                <a href="#" class="fw-bold text-dark small text-decoration-underline">SHOP NOW</a>
                            </div>
                        </div>
                        <div class="carousel-item carousel-item-custom" style="background-image: url('https://images.unsplash.com/photo-1617137968427-85924c809a22?q=80&w=1000');">
                            <div class="slider-content">
                                <div class="slider-title">Summer Vibes</div>
                                <div class="slider-sub">New T-Shirts Arrrived</div>
                                <a href="#" class="fw-bold text-dark small text-decoration-underline">DISCOVER</a>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#menSlider" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#menSlider" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    </button>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="d-flex justify-content-end mb-3 gap-3 small text-uppercase fw-bold text-muted">
                    <a href="#" class="text-dark border-bottom border-dark border-2 pb-1">T-Shirts</a>
                    <a href="#" class="text-muted hover-dark">Jeans</a>
                    <a href="#" class="text-muted hover-dark">Jackets</a>
                </div>

                <div class="row row-cols-2 row-cols-md-3 g-3">
                    {% for product in products|slice:":6" %}
                    <div class="col">
                        <div class="product-card mini-card">
                            <div class="product-img-wrap" style="height: 220px;">
                                <a href="{% url 'product_detail' product.id %}" class="product-img-link">
                                    {% if product.image %}
                                        <img src="{{ product.image.url }}" alt="{{ product.name }}">
                                    {% else %}
                                        <img src="https://via.placeholder.com/300x400" alt="No Image">
                                    {% endif %}
                                </a>
                                <div class="product-actions">
                                    <a href="{% url 'product_detail' product.id %}" class="action-btn"><i class="far fa-eye"></i></a>
                                    <a href="{% url 'add_to_cart' product.id %}" class="action-btn"><i class="fas fa-shopping-cart"></i></a>
                                </div>
                            </div>
                            <div class="product-info p-2">
                                <div class="product-cat text-muted" style="font-size: 10px;">{{ product.category }}</div>
                                <div class="product-title" style="font-size: 13px;"><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></div>
                                <div class="product-price" style="font-size: 14px;">
                                    {{ product.selling_price|currency:request }}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>
</div>

<div class="container mb-5 mt-5">
    <div class="row g-0 rounded overflow-hidden shadow-sm">
        <div class="col-md-6 bg-light d-flex align-items-center p-5">
            <div>
                <span class="badge bg-danger mb-2">LIMITED TIME</span>
                <h2 class="fw-bold mb-3">Men's Premium Collection</h2>
                <p class="text-muted mb-4">Discover the latest trends in men's fashion. Suits, Casuals, and more.</p>
                <a href="#" class="btn btn-dark rounded-pill px-4 py-2">EXPLORE NOW</a>
            </div>
        </div>
        <div class="col-md-6" style="min-height: 300px; background: url('https://images.unsplash.com/photo-1617137968427-85924c809a22?auto=format&fit=crop&w=800&q=80') center/cover;"></div>
    </div>
</div>

{% endblock %}