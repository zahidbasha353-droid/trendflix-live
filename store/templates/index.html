{% extends 'store/base.html' %}
{% load static %}
{% load custom_filters %} 

{% block content %}

<style>
    :root {
        --meesho-pink: #f43397;
        --meesho-bg: #f9f9f9;
        --text-dark: #333;
        --text-grey: #666;
        --rating-green: #23bb75;
    }

    body { background-color: var(--meesho-bg) !important; font-family: 'Mier B', -apple-system, BlinkMacSystemFont, sans-serif; }

    .app-download-strip {
        background-color: var(--meesho-pink);
        color: white; padding: 10px 0; text-align: center; font-size: 14px;
        position: sticky; top: 0; z-index: 1050; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .download-btn {
        background-color: white; color: var(--meesho-pink); padding: 4px 12px;
        border-radius: 20px; text-decoration: none; font-weight: bold; margin-left: 10px; font-size: 12px;
    }

    .main-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .hero-banner { width: 100%; margin-bottom: 30px; border-radius: 12px; overflow: hidden; }
    .banner-item img { width: 100%; border-radius: 12px; display: block; }

    .brand-strip-title { font-size: 24px; font-weight: 700; margin: 20px 0; color: var(--text-dark); display: flex; align-items: center; gap: 10px; }
    .brand-scroll { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
    .brand-scroll::-webkit-scrollbar { display: none; }
    .brand-card { min-width: 110px; text-align: center; }
    .brand-img-box { width: 100%; height: 110px; border-radius: 50%; overflow: hidden; border: 1px solid #e0e0e0; background: white; }
    .brand-img-box img { width: 100%; height: 100%; object-fit: cover; }

    .content-wrapper { display: flex; gap: 20px; }
    .filter-sidebar { width: 260px; display: none; background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; height: fit-content; }
    .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; flex: 1; }

    .m-card { background: white; border-radius: 8px; border: 1px solid #eee; transition: 0.3s; overflow: hidden; height: 100%; }
    .m-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .m-img-wrap { height: 250px; overflow: hidden; background: #fff; }
    .m-img { width: 100%; height: 100%; object-fit: contain; }
    .m-info { padding: 12px; }
    .m-price { font-size: 18px; font-weight: 800; color: var(--text-dark); }
    .m-off { color: var(--rating-green); font-size: 12px; font-weight: 600; }
    
    /* Premium Amazon Button Style */
    .btn-amazon {
        background-color: #ffd814; color: #0f1111 !important;
        font-weight: 700; border-radius: 8px; border: none;
        padding: 10px; text-align: center; text-decoration: none;
        display: block; margin-top: 10px; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn-amazon:hover { background-color: #f7ca00; }

    @media (min-width: 992px) { .filter-sidebar { display: block; } }
    @media (max-width: 768px) {
        .grid-container { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .m-img-wrap { height: 180px; }
    }
</style>

<div class="app-download-strip">
    <div class="container d-flex justify-content-center align-items-center">
        <span>ðŸ”¥ <strong>Get 35% OFF</strong> on App!</span>
        <a href="#" class="download-btn">Download Now</a>
    </div>
</div>

<div class="main-container">
    <section class="hero-banner">
        {% for banner in banners %}
            <div class="banner-item">
                <a href="{{ banner.button_link }}">
                    <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
                </a>
            </div>
        {% empty %}
            <img src="https://via.placeholder.com/1200x400?text=Welcome+to+TrendFlix+HQ" style="width:100%;">
        {% endfor %}
    </section>

    <div class="brand-strip-title">
        <span>Shop by Category</span>
        <div style="flex:1; height:1px; background:#e0e0e0;"></div>
    </div>
    
    <div class="brand-scroll">
        {% for cat in categories %}
        <div class="brand-card">
            <div class="brand-img-box">
                <img src="{% if cat.image %}{{ cat.image.url }}{% else %}https://via.placeholder.com/100{% endif %}" alt="{{ cat.name }}">
            </div>
            <div class="brand-name" style="margin-top: 5px; font-size: 13px;">{{ cat.name }}</div>
        </div>
        {% endfor %}
    </div>

    <div class="content-wrapper" style="margin-top: 30px;">
        <div class="filter-sidebar">
            <div style="font-weight: bold; margin-bottom: 15px;">Filters</div>
            <div style="font-size: 13px; color: #666;">
                <p><input type="checkbox"> Men's Fashion</p>
                <p><input type="checkbox"> Women's Western</p>
                <hr>
                <p>Price: Under â‚¹500</p>
            </div>
        </div>

        <div class="product-grid-area" style="flex: 1;">
            <div style="font-size: 20px; font-weight: bold; margin-bottom: 15px;">Products For You</div>
            <div class="grid-container">
                {% for product in products %}
                <div class="m-card">
                    <div class="m-img-wrap">
                        <a href="{{ product.affiliate_link }}" target="_blank">
                            {% if product.image_url_path %}
                                <img src="{{ product.image_url_path }}" alt="{{ product.name }}" class="m-img">
                            {% elif product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="m-img">
                            {% else %}
                                <img src="https://via.placeholder.com/300x400" alt="No Image" class="m-img">
                            {% endif %}
                        </a>
                    </div>

                    <div class="m-info">
                        <div style="font-size: 13px; color: #666; height: 38px; overflow: hidden; margin-bottom: 5px;">
                            {{ product.name|truncatechars:45 }}
                        </div>
                        
                        <div style="margin: 5px 0;">
                            <span class="m-price">{{ product.selling_price|currency:request }}</span>
                            <span style="font-size: 11px; text-decoration: line-through; color: #999; margin-left: 5px;">â‚¹{{ product.cost_price }}</span>
                            <span class="m-off">{{ product.profit }}% off</span>
                        </div>

                        <div style="font-size: 12px; color: var(--rating-green); margin-bottom: 10px;">
                            <span style="background: var(--rating-green); color: white; padding: 2px 6px; border-radius: 10px; font-weight: bold;">4.2 â˜…</span>
                            <span style="color: #666; margin-left: 5px;">Free Delivery</span>
                        </div>

                        <a href="{{ product.affiliate_link }}" target="_blank" class="btn-amazon">
                            <i class="fab fa-amazon"></i> Buy on Amazon
                        </a>
                    </div>
                </div>
                {% empty %}
                <p class="text-center w-100">No products found. Start your Amazon Bot!</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock %}