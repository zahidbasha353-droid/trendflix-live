{% extends 'store/base.html' %}
{% load static %}
{% load custom_filters %} 

{% block content %}

<style>
    /* =========================================
       üé® MEESHO STYLE COLOR PALETTE
       ========================================= */
    :root {
        --meesho-pink: #f43397;
        --meesho-bg: #f9f9f9;
        --text-dark: #333;
        --text-grey: #666;
        --rating-green: #23bb75;
    }

    body { background-color: var(--meesho-bg) !important; font-family: 'Mier B', -apple-system, BlinkMacSystemFont, sans-serif; }

    /* =========================================
       üñ•Ô∏è DESKTOP LAYOUT (Sidebar + Grid)
       ========================================= */
    .main-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* 1. HERO BANNER */
    .hero-banner { 
        width: 100%; height: 350px; border-radius: 8px; overflow: hidden; margin-bottom: 30px; 
        background-size: cover; background-position: center; position: relative;
    }
    
    /* 2. CATEGORY STRIP (Original Brands Style) */
    .brand-strip-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: var(--text-dark); display: flex; align-items: center; gap: 10px; }
    .brand-strip-title i { color: #5d5d5d; }
    
    .brand-scroll { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
    .brand-scroll::-webkit-scrollbar { display: none; }
    
    .brand-card { min-width: 120px; text-align: center; cursor: pointer; }
    .brand-img-box { 
        width: 100%; height: 120px; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; 
        background: white; display: flex; align-items: center; justify-content: center;
    }
    .brand-img-box img { width: 100%; height: 100%; object-fit: cover; }
    .brand-name { margin-top: 8px; font-size: 14px; color: var(--text-grey); font-weight: 500; }
    .brand-btn { 
        background: var(--meesho-pink); color: white; border: none; padding: 5px 15px; 
        border-radius: 4px; font-size: 12px; margin-top: 5px; width: 100%;
    }

    /* 3. SPLIT LAYOUT (Sidebar & Products) */
    .content-wrapper { display: flex; gap: 20px; margin-top: 30px; }
    
    /* LEFT SIDEBAR (Filters) */
    .filter-sidebar { 
        width: 280px; background: white; border-radius: 4px; border: 1px solid #e0e0e0; 
        padding: 15px; height: fit-content; display: none; /* Hidden on mobile */
    }
    .filter-group { border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px; }
    .filter-title { font-size: 16px; font-weight: 600; margin-bottom: 10px; color: var(--text-dark); }
    .filter-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 14px; color: var(--text-grey); cursor: pointer; }
    .filter-item input { accent-color: var(--meesho-pink); }

    /* RIGHT PRODUCT GRID */
    .product-grid-area { flex: 1; }
    .sort-bar { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center; }
    .grid-container { 
        display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; 
    }

    /* MEESHO PRODUCT CARD */
    .m-card { 
        background: white; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; 
        transition: 0.2s; position: relative; cursor: pointer;
    }
    .m-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
    
    .m-img-wrap { height: 220px; overflow: hidden; position: relative; }
    .m-img { width: 100%; height: 100%; object-fit: cover; }
    
    .m-info { padding: 12px; }
    .m-title { 
        font-size: 14px; color: #999; margin-bottom: 4px; 
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
    }
    .m-price-row { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
    .m-price { font-size: 20px; font-weight: 700; color: var(--text-dark); }
    .m-old-price { font-size: 12px; text-decoration: line-through; color: #999; }
    .m-off { font-size: 12px; color: var(--rating-green); font-weight: 600; }
    
    .m-badge-row { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
    .m-rating { 
        background: var(--rating-green); color: white; font-size: 12px; 
        padding: 2px 8px; border-radius: 12px; display: flex; align-items: center; gap: 4px; font-weight: 700;
    }
    .m-free-del { 
        background: #f0f0f0; color: #666; font-size: 10px; 
        padding: 2px 6px; border-radius: 4px; font-weight: 600;
    }

    /* AFFILIATE BUTTON */
    .m-btn { 
        display: block; width: 100%; text-align: center; background: white; 
        color: var(--meesho-pink); border: 1px solid var(--meesho-pink); 
        font-weight: 600; padding: 8px; margin-top: 10px; border-radius: 4px; text-decoration: none;
        transition: 0.3s;
    }
    .m-btn:hover { background: var(--meesho-pink); color: white; }

    /* =========================================
       üì± MOBILE RESPONSIVENESS
       ========================================= */
    @media (min-width: 992px) {
        .filter-sidebar { display: block; } /* Show Sidebar on Desktop */
    }

    @media (max-width: 768px) {
        .main-container { padding: 10px; }
        .hero-banner { height: 180px; margin-bottom: 20px; }
        
        .brand-card { min-width: 90px; }
        .brand-img-box { height: 90px; }
        .brand-name { font-size: 12px; }
        
        .grid-container { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .m-img-wrap { height: 200px; } /* Tall images for fashion */
        .m-price { font-size: 16px; }
        
        /* Bottom Navigation Space */
        body { padding-bottom: 70px; }
        
        /* Hide Desktop Elements */
        .desktop-only { display: none; }
    }
    
    /* Bottom Nav (Same as before for App feel) */
    .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; }
    .nav-icon { text-align: center; font-size: 10px; color: #555; text-decoration: none; }
    .nav-icon i { font-size: 20px; display: block; margin-bottom: 2px; }
    .nav-icon.active { color: var(--meesho-pink); font-weight: bold; }
    
    @media (min-width: 769px) { .bottom-nav { display: none; } }
</style>

<div class="main-container">

    <div class="hero-banner" style="background-image: url('{% if main_banner %}{{ main_banner.image.url }}{% else %}https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?auto=format&fit=crop&w=1470&q=80{% endif %}');">
        </div>

    <div class="brand-strip-title">
        <span>Shop by Category</span>
        <div style="flex:1; height:1px; background:#e0e0e0;"></div>
    </div>
    
    <div class="brand-scroll">
        {% for cat in categories %}
        <div class="brand-card">
            <div class="brand-img-box">
                {% if cat.image %}
                    <img src="{{ cat.image.url }}" alt="{{ cat.name }}">
                {% else %}
                    <img src="https://via.placeholder.com/100" alt="No Image">
                {% endif %}
            </div>
            <div class="brand-name">{{ cat.name }}</div>
        </div>
        {% endfor %}
    </div>

    <div class="content-wrapper">
        
        <div class="filter-sidebar">
            <div class="filter-title">Filters</div>
            
            <div class="filter-group">
                <div class="filter-title" style="font-size:14px;">Category</div>
                <label class="filter-item"><input type="checkbox"> Men's Fashion</label>
                <label class="filter-item"><input type="checkbox"> Women's Western</label>
                <label class="filter-item"><input type="checkbox"> Electronics</label>
            </div>

            <div class="filter-group">
                <div class="filter-title" style="font-size:14px;">Price</div>
                <label class="filter-item"><input type="checkbox"> Under ‚Çπ500</label>
                <label class="filter-item"><input type="checkbox"> ‚Çπ500 - ‚Çπ1000</label>
                <label class="filter-item"><input type="checkbox"> Over ‚Çπ1000</label>
            </div>
            
            <div class="filter-group">
                <div class="filter-title" style="font-size:14px;">Rating</div>
                <label class="filter-item"><input type="checkbox"> 4.0+ Stars</label>
                <label class="filter-item"><input type="checkbox"> 3.0+ Stars</label>
            </div>
        </div>

        <div class="product-grid-area">
            <div class="sort-bar">
                <div class="brand-strip-title" style="font-size: 20px; margin:0;">Products For You</div>
                <select class="form-select w-auto desktop-only">
                    <option>Relevance</option>
                    <option>Price: Low to High</option>
                    <option>Price: High to Low</option>
                </select>
            </div>

            <div class="grid-container">
                {% for product in products %}
                <a href="{{ product.affiliate_link }}" target="_blank" style="text-decoration: none;">
                    <div class="m-card">
                        <div class="m-img-wrap">
                            {% if product.image %}
                                <img src="{{ product.image.url }}" class="m-img">
                            {% else %}
                                <img src="https://via.placeholder.com/300x400" class="m-img">
                            {% endif %}
                        </div>
                        
                        <div class="m-info">
                            <div class="m-title">{{ product.name }}</div>
                            
                            <div class="m-price-row">
                                <span class="m-price">{{ product.selling_price|currency:request }}</span>
                                <span class="m-old-price">‚Çπ{{ product.cost_price|add:"200" }}</span>
                                <span class="m-off">{{ product.profit }}% off</span>
                            </div>
                            
                            <div class="m-badge-row">
                                <span class="m-rating">4.2 <i class="fas fa-star" style="font-size:9px;"></i></span>
                                <span class="m-free-del">Free Delivery</span>
                            </div>

                            <button class="m-btn">Shop Now</button>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>

</div>

<div class="bottom-nav">
    <a href="{% url 'home' %}" class="nav-icon active">
        <i class="fas fa-home"></i> Home
    </a>
    <a href="#" class="nav-icon">
        <i class="fas fa-th-large"></i> Categories
    </a>
    <a href="#" class="nav-icon">
        <i class="fas fa-shopping-bag"></i> Orders
    </a>
    <a href="#" class="nav-icon">
        <i class="fas fa-user"></i> Account
    </a>
</div>

{% endblock %}