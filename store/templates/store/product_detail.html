{% extends 'store/base.html' %}

{% block content %}
<style>
    /* AMAZON STYLE LAYOUT */
    .product-container { margin-top: 30px; margin-bottom: 50px; }
    .main-image { width: 100%; border-radius: 12px; border: 1px solid #eee; position: sticky; top: 20px; }
    .product-title { font-size: 28px; font-weight: 700; color: #111; margin-bottom: 5px; }
    .price-block { margin: 15px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 15px 0; }
    .selling-price { font-size: 28px; font-weight: 500; color: #B12704; }
    
    /* BULK MODE STYLES */
    .bulk-box { background: #f8f9fa; border: 2px dashed #e11d48; padding: 20px; border-radius: 10px; margin-top: 20px; display: none; }
    .size-input { width: 60px; text-align: center; border: 1px solid #ccc; border-radius: 5px; padding: 5px; }
    .discount-badge { background: #22c55e; color: white; padding: 2px 8px; font-size: 12px; border-radius: 4px; display: none; }
</style>

<div class="container product-container">
    <div class="row">
        <div class="col-md-5">
            <img src="{{ product.image_url }}" class="main-image shadow-sm" alt="{{ product.name }}">
        </div>

        <div class="col-md-6 offset-md-1">
            <h1 class="product-title">{{ product.name }}</h1>
            <p class="text-muted small mb-0">Brand: <span class="text-dark fw-bold">Trendflix Originals</span></p>

            <div class="price-block">
                <div>
                    <span class="small text-danger fw-bold">-40%</span>
                    <span class="selling-price">‚Çπ{{ product.selling_price }}</span>
                    <span class="discount-badge" id="bulk-alert">BULK DISCOUNT APPLIED!</span>
                </div>
            </div>

            <p class="text-muted">{{ product.description }}</p>

            <div class="form-check form-switch mt-4 p-3 bg-light rounded border">
                <input class="form-check-input" type="checkbox" id="bulkToggle" onchange="toggleBulkMode()">
                <label class="form-check-label fw-bold ms-2" for="bulkToggle">
                    üè¢ Order in Bulk / Uniform (Schools, Offices)
                </label>
            </div>

            <form action="{% url 'add_to_cart' product.id %}" method="POST">
                {% csrf_token %}
                
                <div id="normal-mode" class="mt-3">
                    <label class="fw-bold">Select Size:</label>
                    <select name="size" class="form-control w-50 mb-3">
                        <option value="S">Small (S)</option>
                        <option value="M" selected>Medium (M)</option>
                        <option value="L">Large (L)</option>
                        <option value="XL">Extra Large (XL)</option>
                        <option value="XXL">XXL</option>
                    </select>
                </div>

                <div id="bulk-mode" class="bulk-box">
                    <h6 class="fw-bold text-danger"><i class="fa-solid fa-users"></i> Bulk Quantity Table</h6>
                    <small class="text-muted">Enter quantity for each size. (Auto 10% Off for 10+ items)</small>
                    
                    <table class="table table-bordered mt-2 bg-white text-center">
                        <thead class="table-dark">
                            <tr>
                                <th>Size</th><th>S</th><th>M</th><th>L</th><th>XL</th><th>XXL</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Qty</td>
                                <td><input type="number" name="bulk_S" class="size-input" min="0" value="0"></td>
                                <td><input type="number" name="bulk_M" class="size-input" min="0" value="0"></td>
                                <td><input type="number" name="bulk_L" class="size-input" min="0" value="0"></td>
                                <td><input type="number" name="bulk_XL" class="size-input" min="0" value="0"></td>
                                <td><input type="number" name="bulk_XXL" class="size-input" min="0" value="0"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-warning w-100 fw-bold py-3 fs-5 rounded-pill shadow-sm">
                        ADD TO CART <i class="fa-solid fa-cart-shopping ms-2"></i>
                    </button>
                    
                    <a href="{% url 'buy_now' product.id %}" class="btn btn-dark w-100 fw-bold mt-2 py-2 rounded-pill">
                        Buy Single Item Now
                    </a>
                </div>
            </form>
            
            <div class="text-center mt-3">
                <small class="text-muted"><i class="fa-solid fa-lock"></i> Secure Transaction</small>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleBulkMode() {
        var isBulk = document.getElementById('bulkToggle').checked;
        var normalDiv = document.getElementById('normal-mode');
        var bulkDiv = document.getElementById('bulk-mode');
        var alertBadge = document.getElementById('bulk-alert');
        
        if (isBulk) {
            normalDiv.style.display = 'none';
            bulkDiv.style.display = 'block';
            alertBadge.style.display = 'inline-block';
        } else {
            normalDiv.style.display = 'block';
            bulkDiv.style.display = 'none';
            alertBadge.style.display = 'none';
        }
    }
</script>
{% endblock %}